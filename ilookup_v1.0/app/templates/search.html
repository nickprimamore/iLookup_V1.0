{% extends "layout.html"%}

{% block content %}
<script>

  //Select2 is an add-on package that allows you to have pill boxes with multiple inputs.
  $(document).ready(function() {
    $('.dropdowns').select2();
  });

  // Sends the selected search tags to the backend
  function sendData() {
    //The format of $('._____').val() gives the results from the select2 Tables
    var clientVal = $('.clients').val()
    var productVal = $('.products').val()
    var releaseVal = $('.releases').val()
    var regionVal = $('.regions').val()
    var clusterVal = $('.clusters').val()
    var environmentVal = $('.environments').val()
    var componentVal = $('components').val()

    var dateFrom = document.getElementById("dateFrom").value;
    var dateUntil = document.getElementById("dateUntil").value;

    //Generated empty arrays, and filled them with the values from above to send to the backend as an array.
    var clientList = []
    var productList = []
    var releaseList = []
    var regionList = []
    var clusterList = []
    var environmentList = []
    var componentList = []
    var dateList = [dateFrom, dateUntil];

    //Populates all the lists with the search values
    for (var cli in clientVal) {
      clientList.push(clientVal[cli])
    }
    for (var pro in productVal) {
      productList.push(productVal[pro])
    }
    for (var rel in releaseVal) {
      releaseList.push(releaseVal[rel])
    }
    for (var reg in regionVal) {
      regionList.push(regionVal[reg])
    }
    for (var clu in clusterVal) {
      clusterList.push(clusterVal[clu])
    }
    for (var env in environmentVal) {
      environmentList.push(environmentVal[env])
    }
    for (var com in componentVal) {
      componentList.push(componentVal[com])
    }

    //send back and Ajax Request with the following information.
      $.ajax({
      url: '/result',
      type: 'POST',
      data: JSON.stringify({
        Clients: clientList,
        Products: productList,
        Releases: releaseList,
        Regions: regionList,
        Clusters: clusterList,
        Environments: environmentList,
        Components: componentList,
        Dates: dateList
      }),
      success: function (response) {
        $('#result-tag').html(response)
      }
    })
  }

</script>

<style>
  div.searchContainer {
    display:flex;
    flex-wrap:wrap;
    margin: 0% 20%
  }
  div.searchBar {
    text-align:left;
  }
  p.searchLabel {
    color:#2867b1;
    margin-bottom:5px;
  }
  select.dropdowns {
    width: 100%
  }
  label.modalLabel {
    color:#2867b1;
    font-weight:bold;
  }
</style>

<h1 style="padding-top:14px; padding-bottom:11px" align="center"> Search <span style="color:#FF9900">aws</span> Resources:</h1>

<div class="searchContainer">
  <div class="searchBar col-md-6">
    <p class="searchLabel" > <b> Clients </b> </p>
    <select class="dropdowns clients"  name="clients[]" multiple="multiple">
      {% for client in clientsQ %}
        <option value="{{ client.client_name }}">{{ client.client_name }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="searchBar col-md-6">
    <p class="searchLabel"> <b> Products </b> </p>
    <select class="dropdowns products" id="products"  name="products[]" multiple="multiple">
      {% for product in productsQ %}
        <option value="{{ product.product_name }}">{{ product.product_name }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="searchBar col-md-6">
    <p class="searchLabel"> <b> Releases </b> </p>
    <select class="dropdowns releases"  name="releases[]" multiple="multiple">
      {% for release in releasesQ %}
        <option value="{{ release.release_number }}">{{ release.release_number }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="searchBar col-md-6">
    <p class="searchLabel"> <b> Regions </b> </p>
    <select class="dropdowns regions"  name="regions[]" multiple="multiple">
      {% for region in regionsQ %}
        <option value="{{ region }}">{{ region }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="searchBar col-md-6">
    <p class="searchLabel"> <b> Clusters </b> </p>
    <select class="dropdowns clusters"  name="clusters[]" multiple="multiple">
      {% for cluster in clustersQ %}
        <option value="{{ cluster.cluster_name }}">{{ cluster.cluster_name }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="searchBar col-md-6">
    <p class="searchLabel"> <b> Environments </b> </p>
    <select class="dropdowns environments"  name="environments[]" multiple="multiple">
      {% for environment in environmentsQ %}
        <option value="{{ environment }}">{{ environment }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="searchBar col-md-6">
    <p class="searchLabel"> <b> Components </b> </p>
    <select class="dropdowns components"  name="components[]" multiple="multiple">
      {% for component in componentsQ %}
        <option value="{{ component.component_name }}">{{ component.component_name }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="form-group col-md-3" style = padding-right:1%>
      <!--<label for="date (from)">Date (From)</label>!-->
      <p class="searchLabel"> <b> Date (From) </b> </p>
      <input type="date" class="form-control" id="dateFrom"name="Date (From)">
  </div>
  <div class="form-group col-md-3">
      <!--<label for="date (until)">Date (Until)</label>-->
      <p class="searchLabel"> <b> Date (Until) </b> </p>
      <input type="date" class="form-control" id="dateUntil" name="Date (Until)">
  </div>
  <div class="searchBar col-md-12">
    <button type="button" class="btn btn-outline-warning" style="width:100%" onClick="sendData()">Search</button>
  </div>

  <br>
  <br>
  <br>

  <!-- Modal for adding a release tag -->
  <div class="modal fade no-reload" id="addTagModal" tabindex="-1" role="dialog" aria-labelledby="addTagLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addTagLabel">Add a New Release Tag:</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form>
              <div class="form-group">
                <label class="modalLabel" for="selectProduct">Product:</label>
                <select class="form-control" id="selectProduct" placeholder="Select product">
                  <option value="" disabled selected>Select product</option>
                  {% for product in productsQ %}
                    <option value="{{ product.product_name }}">{{ product.product_name }}</option>
                  {% endfor %}
                </select>
              </div>
          </form>
          <form>
            <div class="form-group">
              <label class="modalLabel" for="releaseNum">Release Number:</label>
              <input type="email" class="form-control" id="releaseNum" aria-describedby="releaseFormat" placeholder="Enter release">
              <small id="releaseFormat" class="form-text text-muted">Example format: 01.01.01.01</small>
            </div>
          </form>
          <form>
            <div class="searchBar col-md-6">
              <p class="searchLabel"> <b> Clusters:</b> </p>
                <select class="dropdowns clusters" id="addClustersSelect2" style="width:214%" name="clusters[]" multiple="multiple">
                  {% for cluster in clustersQ %}
                  <option value="{{ cluster.cluster_name }}">{{ cluster.cluster_name }}</option>
                  {% endfor %}
                </select>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" data-dismiss="modal">Add tag</button>
        </div>
      </div>
    </div>
  </div>

  <!-- This script clears out the add tag modal after submission/closing -->
  <script>
    $('#addTagModal').on('hidden.bs.modal', function (e) {
        $(this)
          .find("input, select")
          .val('')
          .end()
          $('#addClustersSelect2').val(null).trigger('change');
    });
  </script>

  <!-- Modal for updating a release tag -->
  <div class="modal fade" id="updateTagModal" tabindex="-1" role="dialog" aria-labelledby="updateTagLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="updateTagLabel">Update a Release Tag:</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form>
              <div class="form-group">
                <label class="modalLabel" for="selectProduct">Product:</label>
                <select class="form-control" id="selectProduct">
                  <option value="" disabled selected>Select product</option>
                  {% for product in productsQ %}
                    <option value="{{ product.product_name }}">{{ product.product_name }}</option>
                  {% endfor %}
                </select>
              </div>
          </form>
          <form>
            <div class="form-group">
              <label class="modalLabel" for="releaseNum">New Release Number:</label>
              <input type="email" class="form-control" id="releaseNumUpdated" aria-describedby="releaseUpdatedFormat" placeholder="Enter new release">
              <small id="releaseUpdatedFormat" class="form-text text-muted">Example format: 01.01.01.01</small>
            </div>
          </form>
          <form>
            <div class="searchBar col-md-6">
              <p class="searchLabel"> <b> Clusters:</b> </p>
                <select class="dropdowns clusters" id="updateClustersSelect2" style="width:214%" name="clusters[]" multiple="multiple">
                  {% for cluster in clustersQ %}
                  <option value="{{ cluster.cluster_name }}">{{ cluster.cluster_name }}</option>
                  {% endfor %}
                </select>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" data-dismiss="modal">Update tag</button>
        </div>
      </div>
    </div>
  </div>

  <!-- This script clears out the update tag modal after submission/closing -->
  <script>
    $('#updateTagModal').on('hidden.bs.modal', function (e) {
        $(this)
          .find("input, select")
          .val('')
          .end()
          $('#updateClustersSelect2').val(null).trigger('change');
    });
  </script>

<!-- This is where the table is being rendered in! -->
</div>
<div id="result-tag"></div>

{% block resultContent%}
{% endblock %}

{% endblock %}

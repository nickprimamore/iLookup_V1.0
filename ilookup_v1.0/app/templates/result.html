
<!-- This script is the one that takes the entry clicked on and relays the information into the modal -->
<script>
  $('#clusterDetail').on('show.bs.modal', function (event) {
    let trigger = $(event.relatedTarget)
    let tasks = trigger.data('tasks')
    let clusterName = trigger.data('clustername')
    tasks = tasks.split('{')
    tasks.shift()
    let compTasks = []
    for (let i = 0; i < tasks.length; i++) {
      strObject = tasks[i]
      strObject = "{" + strObject
      strObject = strObject.substring(0, strObject.length-1)
      strObject = strObject.replace(/'/g, '"').replace(/u/g, '')
      if (i+1 != tasks.length) {
        strObject = strObject.substring(0, strObject.length-1)
      }
      strObject = JSON.parse(strObject)
      compTasks.push(strObject)
    }
    let modal = $(this)
    modal.find('.cluster-title').text('Cluster: ' + clusterName)


    for (task of compTasks) {
      console.log(task)
      let image = task.image_tag.substring(task.image_tag.length-7, task.image_tag.length)
      let memory = task.memory
      let date = task.date
      let cpu = task.cp
      let revision = task.revision
      let task_name = task.task_definition_name

      $( "#accordion" ).append('<div class="card">' +
        '<div class="card-header deleteOnClose" id="headingOne">' +
          '<h5 class="mb-0 deleteOnClose">' +
            '<button class="btn btn-link deleteOnClose" data-toggle="collapse" data-target="#' + image + '" aria-expanded="true" aria-controls="' + image + '">' +
            task_name + '<br class="deleteOnClose"/>' +
            '</button>' +
          '</h5>' +
        '</div>'+
        '<div id="' + image + '" class="collapse deleteOnClose" aria-labelledby="headingOne" data-parent="#accordion">' +
          '<div class="card-body deleteOnClose">' +
            'Image: ' + image + '<br class="deleteOnClose" />' +
            'Revision: ' + revision + '<br class="deleteOnClose"/>' +
            'Memory: ' + memory + '<br class="deleteOnClose"/>' +
            'Date Started: ' + date + '<br class="deleteOnClose"/>' +
            'CPU: ' + cpu + '<br class="deleteOnClose" />' +
          '</div>' +
        '</div>' +
      '</div>')
    }
  })
  $('#clusterDetail').on('hide.bs.modal', function (event) {
    $('.deleteOnClose').remove();
  })

</script>

<style>
  div.modal-header {
    padding: 10px; 10px;
    padding-bottom: 3px
  }
</style>

<!-- This is the modal and it is working with the function above to create multiple unique modal's based on which entry was pressed. -->
<div class="modal fade bd-example-modal-lg" id="clusterDetail" tabindex="-1" role="dialog" aria-labelledby="clusterLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="cluster-title" id="clusterLabel"></h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div id="accordion">


      </div>
      <!-- <div class="cluster-info">
        <table class="table table-striped">
          <thead>
            <tr>
            </tr>
          </thead>
          <tbody>
            <tr>
              <th scope="row">Task Definition</th>
              <td class="taskdef"></td>
            </tr>
            <tr>
              <th scope="row">Image Tag</th>
              <td class="imagetag"></td>
            </tr>
            <tr>
              <th scope="row">Revision</th>
              <td class="revision"></td>
            </tr>
            <tr>
              <th scope="row">Date</th>
              <td class="date"></td>
            </tr>
            <tr>
              <th scope="row">CPU</th>
              <td class="cpu"></td>
            </tr>
            <tr>
              <th scope="row">Memory</th>
              <td class="memory"></td>
            </tr>
          </tbody>
        </table>
      </div> -->
    </div>
  </div>
</div>

<table class="table table-hover table-striped">
  <thead>
    <tr>
      <th scope="col">Client</th>
      <th scope="col">Product</th>
      <th scope="col">Release #</th>
      <th scope="col">Cluster</th>
      <th scope="col">Environment</th>
      <th scope="col">Region</th>
    </tr>
  </thead>
  <tbody>

<!-- This is a for loop to render the search results  -->

    {% for result in results %}

    <tr
      data-toggle="modal"
      data-target="#clusterDetail"
      data-clustername="{{result.cluster_name}}"
      data-tasks='{{result.task_definitions}}'
      >
      <th scope="row">{{result.client_name}}</th>
      <td> {{result.product_name}} </td>
      <td> {{result.release}} </td>
      <td> {{result.cluster_name}} </td>
      <td> {{result.environment}} </td>
      <td> {{result.region}} </td>
    </tr>

    {% endfor %}

  </tbody>
</table>
